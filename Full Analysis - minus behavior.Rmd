---
title: "Lidoband 2025 Analysis"
author: "EP"
date: "`r Sys.Date()`"
format: 
  html:
    toc: true 
    toc-float: true
    toc-location: left
---

```{r}
#| include: false 
#| warning: false 
#| echo: false 

library(tidyverse)
library(readr)
library(dplyr)
library(emmeans)
library(lme4)
library(lmerTest)
library(nlme)
library(car)
library(epiDisplay)
library(knitr)
library(pROC)
library(tidyverse)
library(readxl)
library(ggplot2)
library(gmodels)
library(ggbeeswarm)
library(dplyr)
library(ggpubr)
library(psych)
library(lme4)
library(Matrix)
library(irr)
library(doBy)       
library(gridGraphics)  
library(multcomp)
library(hms)
library(gt)
library(extrafont)
```

## Data Steps

```{r}
#| include: false 
#| warning: false 
#| echo: false 

#enrollment spreadsheet
enroll <- read_csv("data/enroll.csv")

enroll <- enroll |> 
  filter(`Study ID` !=32)

#sc spreadsheet
sc <- read.csv("data/sc.csv")
sc <- rename(sc, "CalfID" = "Calf.ID")

sc <- sc |>
  filter (Study.ID!= 32)

scfull<- merge(sc, enroll, by = "CalfID")
scfull <- scfull |> 
  rename(TRT = TRT.x)

#health score spreadsheet
hs <- read.csv("data/CHSdata_2025_08_11_08_39.csv")
  hs$CalfID = as.numeric(hs$CalfID)

full<-
hs |> 
  dplyr::select(CalfID, Calf.Age, BodyTemp, Appetite, Attitude, Nose, Eye, Ear, Cough, Temperature, Fecal, Navel, Joint) |> 
 dplyr::mutate(
    TRS = Nose + Eye + Ear + Cough + Temperature,
    THS = Appetite + Attitude + Nose + Eye + Ear + Cough + Temperature + Fecal + Navel + Joint, 
    BRD = if_else(TRS>=4, 1, 0),
    Refuse = if_else(Appetite>=2, 1, 0),
    Scour = if_else(Fecal>=2, 1, 0),
    Fever = if_else(BodyTemp>103.5, 1, 0), 
    Sick = if_else(THS>=4, 1, 0), 
    DiarSS = case_when(
      Fecal <= 1       ~ "Normal", 
      Fecal == 2       ~ "Mild",
      Fecal == 3       ~ "Severe"),
    #DiarSS = factor(DiarSS, levels = c("Normal", "Mild", "Severe"))
    )

hsfull <-  
  merge(full, enroll, by = "CalfID")

anti_join(full, enroll, by = "CalfID")

write.csv(x=hsfull, file = "data/hsfullchecks.csv")

#ethogram
etho <- read.csv("data/ethogram.csv")
 etho$CalfID = as.numeric(etho$CalfID)
 
ethofull<- merge(etho, enroll, by= "CalfID")
ethofull <- ethofull |> 
  rename(TRT = TRT.x)

ethofull<- 
  ethofull %>% 
  mutate( vocalyn = 
    case_when(
      Vocalize >= 1 ~ 1, 
      Vocalize == 0  ~ 0))

ethofull<- 
  ethofull %>% 
  mutate( layyn = 
    case_when(
      Layed.Down >= 1 ~ 1, 
      Layed.Down == 0  ~ 0))




hb <- enroll %>% 
  pivot_longer(
    cols = starts_with("Hb"), 
    names_to = "PrePost", 
    values_to = "HbmgdL"
  ) %>% 
  mutate(
    PrePost = case_when( 
      PrePost == "HbpremgdL"  ~ "Pre", 
      PrePost == "HbpostmgdL" ~ "Post"
    )
  )
```

## Enrollment Description

This describes enrollment characteristics of calves enrolled in the Lidoband Study 2025.

```{r}
#| include: false 
#| warning: false 
#| echo: false 


 enroll |>
  group_by(TRT) |>
  summarize (Count = n())

enroll |> 
  summarize (mean = mean(BWKg, na.rm = TRUE), 
             sd = sd(BWKg, na.rm = TRUE))
 
enroll |>
  group_by(TRT) |>
  summarize (mean = mean(BWKg, na.rm = TRUE), 
             sd = sd(BWKg, na.rm = TRUE))

lmbwt <- lm(BWKg ~ TRT, data=enroll)
summary(lmbwt, type=3)


enroll |> 
  summarize(mean = mean(TP, na.rm = TRUE), 
             sd = sd(TP, na.rm = TRUE))

enroll |>
  group_by(TRT) |>
  summarize (mean = mean(TP, na.rm = TRUE), 
             sd = sd(TP, na.rm = TRUE))

lmtp <- lm(TP ~ TRT, data=enroll)
summary(lmtp, type=3)

enroll |> 
  summarize(mean = mean(AgeatEnroll, na.rm = TRUE), 
             sd = sd(AgeatEnroll, na.rm = TRUE))


enroll |>
  group_by(TRT) |>
  summarize (mean = mean(AgeatEnroll, na.rm = TRUE), 
             sd = sd(AgeatEnroll, na.rm = TRUE))

lmtp <- lm(AgeatEnroll ~ TRT, data=enroll)
summary(lmtp, type=3)


enroll |> 
  group_by (FOO) |> 
  summarize (count = n())

enroll  |>
  group_by(TRT, FOO) |>
  summarize(Count = n())


LidoMeans_Summary<- 
  enroll |> 
  group_by(TRT) |>
  summarise(
    n = n(),
    mean_age = mean(`AgeatEnroll`, na.rm = TRUE),
    sd_age = sd(`AgeatEnroll`, na.rm = TRUE),
    mean_TP = mean(TP, na.rm = TRUE),
    sd_TP = sd(TP, na.rm = TRUE),
    mean_BWKg = mean(BWKg, na.rm = TRUE),
    sd_BWKg = sd(BWKg, na.rm = TRUE)
  )

gt(LidoMeans_Summary)
```

## Scrotal Circumference

This describes the scrotal circumferences in calves for each of the three treatments from day 0 to day 3.

-   SC Summary: groups by both TRT and day, calculates mean and SD of SCAV, and removes grouping

-   SC Overall: overall average scrotal circumference average per treatment group, standard deviation across all days combines

### Descriptive Data

```{r}
#| warning: false 
#| echo: false 

scfull |>
  group_by(TRT) |>
  summarize(
    mean_SC = mean(SCAV, na.rm = TRUE),
    sd_SC   = sd(SCAV, na.rm = TRUE),
    .groups = "drop")

lm_sc <-lm(SCAV~TRT, data=scfull)
summary(lm_sc)

scfull |>
  group_by(TRT, Day) |>
  summarize(
    mean_SC = mean(SCAV, na.rm = TRUE),
    sd_SC   = sd(SCAV, na.rm = TRUE),
    .groups = "drop")


```

### Simple Boxplot, treatment by day

```{r}

ggplot(scfull, aes(x = factor(Day), y = SCAV, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
  labs(
    title = "Scrotal Circumference Across Days",
    x = "Day",
    y = "SCAV (Scrotal Circumference)"
  ) +
  theme_classic()
```

### Univariable Models

```{r}

scfull$TRT <- relevel(factor(scfull$TRT), ref = "BO")

#yes, associated, duh
lm_Day <- lm(SCAV ~ Day, data=scfull)
summary(lm_Day)

#yes, associated
lm_TRT <- lm(SCAV ~ TRT, data=scfull)
summary(lm_TRT)

#yes, associated
lm_BLSCAV <- lm(SCAV ~ BLSCAV, data=scfull)
summary(lm_BLSCAV)

#yes, associated
lm_BLTRT <- lm(BLSCAV ~ TRT, data=scfull)
summary(lm_BLTRT)

#no, not associated
lm_SCBW <- lm(SCAV ~ BWKg, data=scfull)
summary(lm_SCBW)

#no
lm_age <- lm(SCAV ~ AgeatEnroll, data=scfull)
summary(lm_age)

#no
lm_tp <- lm(SCAV ~ TP, data=scfull)
summary(lm_tp)
```

```{r}

scfull$Day <- factor(scfull$Day, levels = unique(scfull$Day))
scfull$TimeNum <- as.numeric(scfull$Day)

mod_base <- lme(
  fixed=SCAV ~ TRT*Day + BLSCAV,
  random = ~ 1 | CalfID,
  data = scfull
)
summary(mod_base)
car::Anova(mod_base, type=3)

mod_ar1 <- lme( 
  fixed=SCAV ~ TRT*Day + BLSCAV,
  random = ~ 1 | CalfID,
  correlation = corAR1(form = ~ TimeNum | CalfID),
  data=scfull
  )
summary(mod_ar1)
car::Anova(mod_ar1, type=3)

#model will not converge with BLSCAV
#mod_rs <- lme(
  #fixed=SCAV ~ TRT*Day + BLSCAV,
  #random = ~ TimeNum | Calf.ID,
  #data=SC
#)
#summary(mod_rs)
#car::Anova(mod_rs, type=3)

plot (mod_base)
plot (mod_ar1)

anova(mod_base, mod_ar1)
```

### Full Model and Plot

```{r}

scfull$Day <- factor(scfull$Day, levels = unique(scfull$Day))
scfull$TimeNum <- as.numeric(scfull$Day)

mod_ar1 <- lme( 
  fixed=SCAV ~ TRT*Day + BLSCAV,
  random = ~ 1 | CalfID,
  correlation = corAR1(form= ~ TimeNum | CalfID),
  data=scfull
  )
summary(mod_ar1)
car::Anova(mod_ar1, type=3)

emmeans(mod_ar1, ~ Day, adjust="tukey")

emm <- emmeans(mod_ar1, ~ TRT*Day)
emmeans(mod_ar1, ~ TRT*Day)
summary(emm)
pairs(emm, by = "Day")
pairs(emm, by = "TRT")

emm_df <- as.data.frame(emm)

custom_colors <- c("BO" = "red4", "B+N" = "goldenrod2", "LIDO" = "wheat")
ggplot(emm_df, aes(x = Day, y = emmean, color = TRT, group=TRT)) + 
  geom_line(size = 1)+
  scale_color_manual(values=custom_colors)+
  geom_point(size = 1)+
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width =0.2) +
  labs(
    x = "Day",
    y = "Averge Scrotal Circumference (cm)"
  ) +
  theme_classic() +
  scale_y_continuous(limits = c(10.5,13), breaks = seq(10.5,13, by = 0.5))


custom_colors <- c("BO" = "red4", "B+N" = "goldenrod2", "LIDO" = "wheat4")
ggplot(emm_df, aes(x = Day, y = emmean, color = TRT, group=TRT)) + 
  geom_line(size = 1)+
  scale_color_manual(values=custom_colors)+
  geom_point(size = 1)+
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width =0.2) +
  labs(
    x = "Day",
    y = "Averge Scrotal Circumference (cm)"
  ) +
  theme_classic() +
  scale_y_continuous(limits = c(10.0,13), breaks = seq(10.0,13, by = 0.5))+
    theme (legend.position = "none", 
         legend.direction = "horizontal", 
              axis.text = element_text(color = "black", size=10), 
               legend.text = element_text(color = "black", size=9))+
                theme(text=element_text(size=10, family = "Times New Roman"))
```

## Health Score

This will describe the health scores of calves across treatment groups and days. Need to do look at Study ID: 1 46, 53, 57, 62, 63, 82, 94 for data discrepancies. Will figure those out once all the data is pulled in.

```{r}
#| echo: false
#| warning: false

hsfull |> 
  count(Calf.Age) #this will count how many obs per day 

hsfull |> 
  count(TRT) #need to replace this with the name of your treatment groups (TRT, I think)

hsfull |> 
  group_by(Calf.Age, TRT) |> 
  count()

hsfull |> 
  group_by(`Study ID`) |> 
  summarize(
    mean = mean(Calf.Age)
  )

hsfull |> 
  group_by(`CalfID`) |> 
  summarize(
    sum = sum(Calf.Age)
  )
```

### Descriptive Data

```{r}

CrossTable(hsfull$Calf.Age,  hsfull$Appetite, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Attitude, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Nose, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Eye, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Ear, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Cough, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Temperature, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$TRS, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$THS, prop.r = FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$BRD, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Scour, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Fever, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$DiarSS, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Sick, prop.r=FALSE, prop.c = FALSE)
CrossTable(hsfull$Calf.Age,  hsfull$Navel, prop.r=FALSE, prop.c = FALSE)

hsfull |> 
  ggplot(mapping=aes(x=BodyTemp))+
  theme_classic()+
  geom_histogram( 
                 fill="skyblue", 
                 color="black", 
                 alpha=0.7)+
  labs(title = "Histogram of Calf Body Temperature")

hsfull |> 
  filter (Calf.Age == 1) |> 
  ggplot(mapping=aes(x=BodyTemp))+
  theme_classic()+
  geom_histogram( 
                 fill="skyblue", 
                 color="black", 
                 alpha=0.7)+
  labs(title = "Histogram of Calf Body Temperature")
```

### Scours

```{r}
#| warning: false


#What proportion of calves scour in each group?

table(hsfull$TRT, hsfull$Scour)
#         0  1
#   BO   121 3 = 1/123
#   B+N  123 1 = 3/125
#   LIDO 113 9 = 9/122

#worth evaluating with models? Only n=13 calves were ID'd with abnormal FS
CrossTable(hsfull$Scour,  hsfull$Calf.Age, fisher=TRUE) 
CrossTable(hsfull$Scour,  hsfull$TRT, fisher = TRUE) #yes, in lidoband group
CrossTable(hsfull$Scour, hsfull$FOO, fisher = TRUE) #yes
CrossTable(hsfull$Scour, hsfull$Egroup, fisher = TRUE)#no




# Fit a repeated measures mixed effects model for scours.
hsfull$TRT <- relevel(hsfull$TRT, ref = "BO")
model <- glmer(Scour ~ TRT  + FOO + (1 + Calf.Age | CalfID), family = "binomial", data = hsfull)

summary(model)
emmeans(model, specs = "TRT", at = list(TRT = c("BO", "B+N", "LIDO")), type = "response")

fixed_effects <- fixef(model)
odds_ratios <- exp(fixed_effects)
cat("Odds Ratios:\n")
print(odds_ratios)

type3_p_values <- Anova(model, type="III", test="Chisq")
cat("\nType III p-values:\n")
print(type3_p_values)
adjusted_proportions <- odds_ratios / (1 + odds_ratios)
cat("\nAdjusted Proportions:\n")
print(adjusted_proportions)
contrasts <- glht(model, linfct = mcp(TRT = "Tukey"))
summary(contrasts)


```

### Sick

```{r}
#| warning: false


#What proportion of calves sick in each group?

table(hsfull$TRT, hsfull$Sick)
#         0  1
#   BO   100 17 = 17/117 (14.5)
#   B+N  97 26 = 26/123  (21.1)
#   LIDO 88 34 = 34/122  (27.8)

#more calves in Lido.....were they more likely to have fever? 
CrossTable(hsfull$Sick,  hsfull$Calf.Age, fisher=TRUE) #yes, effect of day
CrossTable(hsfull$Sick,  hsfull$TRT, fisher = TRUE) #yes
CrossTable(hsfull$Sick, hsfull$Egroup, fisher = TRUE) #no
CrossTable(hsfull$Sick, hsfull$FOO, fisher = TRUE)


# Fit a repeated measures mixed effects model for cick.
hsfull$TRT <- relevel(hsfull$TRT, ref = "BO")
model <- glmer(Sick ~ TRT  + (1 + Calf.Age | CalfID), family = "binomial", data = hsfull)

summary(model)
emmeans(model, specs = "TRT", at = list(TRT = c("BO", "B+N", "LIDO")), type = "response")

fixed_effects <- fixef(model)
odds_ratios <- exp(fixed_effects)
cat("Odds Ratios:\n")
print(odds_ratios)

type3_p_values <- Anova(model, type="III", test="Chisq")
cat("\nType III p-values:\n")
print(type3_p_values)
adjusted_proportions <- odds_ratios / (1 + odds_ratios)
cat("\nAdjusted Proportions:\n")
print(adjusted_proportions)
contrasts <- glht(model, linfct = mcp(TRT = "Tukey"))
summary(contrasts)








```

### Fever

```{r}
#| warning: false


#What proportion of calves fever (RT > 103.5) in each group?

table(hsfull$TRT, hsfull$Fever)
#          0  1
#   BO   112 10 = 10/122  (8.2)
#   B+N  116 8 = 8/124    (6.4)
#   LIDO 97 24 = 24/121   (19.8)

#more calves in Lido.....were they more likely to have fever? 
CrossTable(hsfull$Fever,  hsfull$Calf.Age, fisher=TRUE) #more on day 2 and 3  
CrossTable(hsfull$Fever,  hsfull$TRT, fisher = TRUE) #yes, more in Lido?
tab <- xtabs(~TRT + Fever + Calf.Age, data=hsfull)

CrossTable(hsfull$Fever, hsfull$Egroup, fisher = TRUE) #yes, more in the second iteration which makes sense bc it was ungodly hot
CrossTable(hsfull$Fever, hsfull$FOO, fisher = TRUE)#no


hsfull$TRT <- factor(hsfull$TRT) 
hsfull$TRT <- relevel(hsfull$TRT, ref = "BO")
model <- glmer(Fever ~ TRT + Egroup + (1 + Calf.Age | CalfID), family = "binomial", data = hsfull)

summary(model)
emmeans(model, specs = "TRT", at = list(TRT = c("BO", "B+N", "LIDO")), type = "response")

fixed_effects <- fixef(model)
odds_ratios <- exp(fixed_effects)
cat("Odds Ratios:\n")
print(odds_ratios)

type3_p_values <- Anova(model, type="III", test="Chisq")
cat("\nType III p-values:\n")
print(type3_p_values)
adjusted_proportions <- odds_ratios / (1 + odds_ratios)
cat("\nAdjusted Proportions:\n")
print(adjusted_proportions)
contrasts <- glht(model, linfct = mcp(TRT = "Tukey"))
summary(contrasts)

emm <- emmeans(model, ~ TRT)
contrast_OR <- contrast(emm, method = "pairwise") %>%
  summary(infer = TRUE, type = "response")
contrast_OR

```

## Ethogram

This will describe the behaviors of calves by treatment group one-minute post castration banding.

```{r}
#| include: false 
#| warning: false 
#| echo: false 

LidoEthoSummary <-
  ethofull |>
  group_by(TRT) |>
  summarize(
    mean_vocalize = mean(Vocalize, na.rm = TRUE),
    sd_vocalize   = sd(Vocalize, na.rm = TRUE),
    mean_kick     = mean(Kick, na.rm = TRUE),
    sd_kick       = sd(Kick, na.rm = TRUE),
    mean_struggle = mean(Struggle, na.rm = TRUE),
    sd_struggle   = sd(Struggle, na.rm = TRUE),
    mean_tail     = mean(Tail.flick, na.rm = TRUE),
    sd_tail       = sd(Tail.flick, na.rm = TRUE),
    mean_down     = mean(Layed.Down, na.rm = TRUE),
    sd_down       = sd(Layed.Down, na.rm = TRUE),
    .groups = "drop"
  )

gt(LidoEthoSummary)

```

### Struggle

#### Description and Boxplot

```{r}

table(ethofull$TRT, ethofull$Struggle)

ggplot(ethofull, aes(x=Struggle))+
  geom_histogram()


ggplot(ethofull, aes(x = TRT, y = Struggle, fill = TRT)) +
  geom_boxplot() +
  geom_jitter()+
   scale_fill_manual(
    values = c(
      "BO" = "red4",
      "B+N" = "goldenrod2",
      "LIDO" = "wheat"))+
  labs(
    title = "Struggle Behavior by Treatment Group",
    x = "Treatment Group",
    y = "Struggle Score"
  ) +
  theme_classic()


#Transformation? 

```

#### Model

```{r}
ethofull$TRT <- relevel(factor(ethofull$TRT), ref = "BO")

lm_s <- lm(Struggle ~ TRT, data=ethofull) #no
summary(lm_s)

lm_sAge <- lm(Struggle ~ AgeatEnroll, data=ethofull) #no
summary(lm_sAge)

lm_sEG <- lm(Struggle ~ Egroup, data=ethofull) #yes
summary(lm_sEG)

lm_sBW <- lm(Struggle ~ BWKg, data=ethofull) #no
summary(lm_sBW)


lm_s <- lm(Struggle ~ TRT + Egroup, data=ethofull)
summary(lm_s, adjust="tukey")

plot(lm_s)
car::Anova(lm_s, type=3)
emmeans(lm_s, ~ TRT)
x <- emmeans(lm_s, ~ TRT)
pairwise_comparisons <- pairs(x)
summary(pairwise_comparisons, adjust="tukey")
summary(pairwise_comparisons, adjust="none")


#poisson regression? 
model <- glm(Struggle ~ TRT, family = poisson(link = "log"), data = ethofull)

# Summary of results
summary(model)

# Exponentiate coefficients to get rate ratios (incidence rate ratios)
exp(coef(model))
confint(model)  # 95% CI
exp(confint(model)) 

```

### Tail Flick

#### Description and Boxplot

```{r}
ggplot(ethofull, aes(x=Tail.flick))+
  geom_histogram()


ethofull |>
  mutate(TRT=factor(TRT, levels=c("BO", "B+N", "LIDO"))) |>
  ggplot(aes(x = TRT, y = Tail.flick, fill = TRT)) +
  geom_boxplot() + 
  geom_jitter() +
  scale_fill_manual(
    values = c(
      "BO" = "red4",
      "B+N" = "goldenrod2",
      "LIDO" = "wheat"
    )
  )+
  labs(
    x = NULL,
    y = "Number of Tail Flicks"
  ) +
  theme_classic() +
  scale_y_continuous(limits = c(0,14), breaks = seq(0,14, by = 2.0))
```

#### Model

```{r}

ethofull$TRT <- relevel(factor(ethofull$TRT), ref = "BO")

lm_TF <- lm(Tail.flick ~ TRT, data=ethofull)
summary(lm_TF)

lm_TFAge <- lm(Tail.flick ~ AgeatEnroll, data=ethofull) #yes
summary(lm_TFAge)

lm_TFEG <- lm(Tail.flick ~ Egroup, data=ethofull) #no
summary(lm_TFEG)

lm_TFBW <- lm(Tail.flick ~ BWKg, data=ethofull) #no
summary(lm_TFBW)

lm_TF <- lm(Tail.flick ~ TRT + AgeatEnroll, data=ethofull)
summary(lm_TF, adjust="tukey")
car::Anova(lm_TF, type=3)

plot(lm_TF)
emmeans(lm_TF, ~ TRT)
x <- emmeans(lm_TF, ~ TRT)
pairwise_comparisons <- pairs(x)
summary(pairwise_comparisons, adjust="tukey")
summary(pairwise_comparisons, adjust="none")
```

### Kicks/Stomps

#### Description and Boxplot

```{r}

ggplot(ethofull, aes(x=Kick))+
  geom_histogram()

ethofull |>
  mutate(TRT=factor(TRT, levels=c("BO", "B+N", "LIDO"))) |>
  ggplot(aes(x = TRT, y = Kick, fill = TRT)) +
  geom_boxplot() + 
  geom_jitter() +
    scale_fill_manual(
    values = c(
      "BO" = "red4",
      "B+N" = "goldenrod2",
      "LIDO" = "wheat"
    )
  )+
  labs(
    x = NULL,
    y = "Number of Kicks/Stomps"
  ) +
  theme_classic() +
  scale_y_continuous(limits = c(0,16), breaks = seq(0,16, by = 2.0))
```

#### Model

```{r}
ethofull$TRT <- relevel(factor(ethofull$TRT), ref = "BO")

lm_Kick <- lm(Kick ~ TRT, data=ethofull) #no
summary(lm_Kick)

lm_KickAge <- lm(Kick ~ AgeatEnroll, data=ethofull) #no
summary(lm_KickAge)

lm_KickEG <- lm(Kick ~ Egroup, data=ethofull) #no
summary(lm_KickEG)

lm_KickBW <- lm(Kick ~ BWKg, data=ethofull) #no
summary(lm_KickBW)

lm_Kick <- lm(Kick ~ TRT , data=ethofull)
summary(lm_Kick, adjust="tukey")
car::Anova(lm_Kick, type=3)

plot(lm_Kick)
emmeans(lm_Kick, ~ TRT)
x <- emmeans(lm_Kick, ~ TRT)
pairwise_comparisons <- pairs(x)
summary(pairwise_comparisons, adjust="tukey")

summary(pairwise_comparisons, adjust="none")
```

### Vocalize

```{r}

ggplot(ethofull, aes(x = TRT, y = Vocalize, fill = TRT)) +
  geom_boxplot() +
  labs(
    title = "Vocalize Behavior by Treatment Group",
    x = "Treatment Group",
    y = "Vocalize Score"
  ) +
  theme_minimal()

table(ethofull$TRT, ethofull$vocalyn)




```

### Lay Down

```{r}

ggplot(ethofull, aes(x = Layed.Down)) +
  geom_histogram() 

table(ethofull$TRT, ethofull$layyn)
 
```

## Serum Haptoglobin (mg/dL)

This describes serum haptoglobin levels in calves in the study.

```{r}
#| warning: false 
#| echo: false 

enroll %>% 
  summarize(
    Pre = mean (HbpremgdL), 
    sdpre = sd(HbpremgdL), 
    Post = mean (HbpostmgdL), 
    sdpost = sd(HbpostmgdL)
  )

enroll %>% 
  group_by(TRT) %>% 
  summarize(
    Pre = mean (HbpremgdL), 
    sdpre = sd(HbpremgdL), 
    Post = mean (HbpostmgdL), 
    sdpost = sd(HbpostmgdL)
  )



ggplot(enroll, aes(x = TRT, y = HbpremgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()

ggplot(enroll, aes(x = HbpremgdL)) +
  geom_histogram() +
    theme_classic()


ggplot(enroll, aes(x = TRT, y = HbpostmgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()
  
ggplot(enroll, aes(x = HbpostmgdL)) +
  geom_histogram() +
    theme_classic()


hb$PrePost <- factor(hb$PrePost, levels = c("Pre", "Post"))

ggplot(hb, aes(x = PrePost, y = HbmgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()


ggplot(hb, aes(x = TRT, y = HbmgdL, color = TRT)) +
  geom_boxplot() +
  facet_wrap(vars(PrePost)) +
  geom_jitter() +
    theme_classic()+
   scale_color_manual(
    values = c(
      "BO" = "red4",
      "B+N" = "goldenrod2",
      "LIDO" = "wheat4"
    ))





lm_pre <-lm(HbpremgdL~TRT, data=enroll)
summary(lm_pre)
emmeans(lm_pre, ~TRT)
plot(lm_pre)



lm_post <-lm(HbpostmgdL~TRT + FOO, data=enroll)
summary(lm_post)
emmeans(lm_post, ~TRT)
plot(lm_post)




#What if we get rid of outlier in the data (n>2.5SD from the mean) Makes it look a lot better, but this is lying with the data. What about a transformation? 

noout<- 
  enroll %>% 
      filter (!HbpostmgdL>33)

noout %>% 
  group_by(TRT) |>
  summarize (Count = n())

 ggplot(noout, aes(x = TRT, y = HbpremgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()

ggplot(noout, aes(x = HbpremgdL)) +
  geom_histogram() +
    theme_classic()


ggplot(noout, aes(x = TRT, y = HbpostmgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()
  
ggplot(noout, aes(x = HbpostmgdL)) +
  geom_histogram() +
    theme_classic()


lm_pre <-lm(HbpremgdL~TRT, data=noout)
summary(lm_pre)
emmeans(lm_pre, ~TRT)
plot(lm_pre)

lm_post <-lm(HbpostmgdL~TRT, data=noout)
summary(lm_post)
emmeans(lm_post, ~TRT)
plot(lm_post)


#What about natural log transformation?

ln<- 
  enroll %>% 
  mutate(
    HbpostmgdL = log(HbpostmgdL), 
    HbpremgdL = log(HbpremgdL))
      

ggplot(ln, aes(x = TRT, y = HbpremgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()

ggplot(ln, aes(x = HbpremgdL)) +
  geom_histogram() +
    theme_classic()


ggplot(ln, aes(x = TRT, y = HbpostmgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()
  
ggplot(ln, aes(x = HbpostmgdL)) +
  geom_histogram() +
    theme_classic()


lm_pre <-lm(HbpremgdL~TRT, data=ln)
summary(lm_pre)
emmeans(lm_pre, ~TRT)
plot(lm_pre)

lm_post <-lm(HbpostmgdL~TRT, data=ln)
summary(lm_post)
emmeans(lm_post, ~TRT)
plot(lm_post)

#natural log for pre-post x trt? 

lnhb<- 
  hb %>% 
  mutate(
    HbmgdL = log(HbmgdL))
      

ggplot(lnhb, aes(x = PrePost, y = HbmgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()

ggplot(lnhb, aes(x = HbmgdL)) +
  geom_histogram() +
    theme_classic()

lm_both <-lm(HbmgdL~TRT*PrePost + Egroup, data=lnhb)
summary(lm_both)
emmeans(lm_both, ~TRT|PrePost)
plot(lm_both)





```

### Models

```{r}
lnhb<- 
  hb %>% 
  mutate(
    HbmgdL = log(HbmgdL))


      

ggplot(lnhb, aes(x = PrePost, y = HbmgdL, color = TRT)) +
  geom_boxplot() +
  geom_jitter() +
    theme_classic()

ggplot(lnhb, aes(x = HbmgdL)) +
  geom_histogram() +
    theme_classic()


lm_hb <- lm(HbmgdL ~ TRT, data=lnhb) #no
summary(lm_hb)

lm_hbAge <- lm(HbmgdL ~ AgeatEnroll, data=lnhb) #no
summary(lm_hbAge)

lm_hbEG <- lm(HbmgdL ~ Egroup, data=lnhb) #yes
summary(lm_hbEG)

lm_hbBW <- lm(HbmgdL ~ BWKg, data=lnhb) #no
summary(lm_hbBW)

lm_hbfoo <- lm(HbmgdL ~ FOO, data=lnhb) #no
summary(lm_hbfoo)


lm_both <-lm(HbmgdL~TRT*PrePost + Egroup, data=lnhb)
summary(lm_both)
emmeans(lm_both, ~TRT|PrePost)
plot(lm_both)


car::Anova(lm_both, type=3)
emmeans(lm_both, ~ TRT)
emmeans(lm_both, ~PrePost)
x <- emmeans(lm_both, ~ TRT)
pairwise_comparisons <- pairs(x)
summary(pairwise_comparisons, adjust="tukey")
summary(pairwise_comparisons, adjust="none")


```
